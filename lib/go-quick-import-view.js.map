{"version":3,"sources":["../src/go-quick-import-view.js"],"names":[],"mappings":"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","file":"go-quick-import-view.js","sourcesContent":["/*@flow*/\nimport { SelectListView } from \"atom-space-pen-views\";\nimport PackageLister from \"./package-lister\";\nimport { AddImport, RemoveImport, ListImports, Header } from \"./modimport\";\nimport { partition, indexBy } from \"lodash\";\n\nfunction pathAliases(): Object {\n  var vals: Array<string> = atom.config.get(\"go-quick-import.importNames\")\n  var paths = {};\n  vals.forEach(val=>{\n    var parts = val.split(\" \");\n    if (parts.length !== 2) return;\n    paths[parts[1]] = parts[0];\n  });\n  return paths;\n}\n\nexport default class GoQuickImportView extends SelectListView {\n  constructor() {\n    super()\n    this.addClass(\"overlay from-top\")\n    this.modalPanel = atom.workspace.addModalPanel({item:this, visible: false});\n    this.visible = false;\n    this.packageLister = new PackageLister();\n    this.setMaxItems(100);\n    this.refresh();\n  }\n  destroy() {\n    this.packageLister.kill();\n    this.modalPanel.destroy();\n    super.destroy();\n  }\n  refresh() {\n    this.setLoading(\"Reading available packages...\");\n    this.packages = [];\n    this.packageLister.refresh().then(pkgs=>{\n      this.setLoading(\"\");\n      this.packages = pkgs;\n      this.updateItems();\n    });\n  }\n  updateItems() {\n    if (!this.visible) return;\n    var imports = ListImports(atom.workspace.getActiveTextEditor().getText());\n    imports = indexBy(imports, \"Path\");\n    var parts = partition(this.packages, pkg=>imports[pkg.Path]);\n    var items = parts[0].map(pkg=>({Remove: true, Path: pkg.Path, Label: `delete: ${pkg.Name} ( ${pkg.Path} )`}));\n    items = items.concat(parts[1].map(pkg=>({Path: pkg.Path, Label: `${pkg.Name} ( ${pkg.Path} )`})));\n    this.setItems(items);\n    this.focusFilterEditor();\n  }\n  show() {\n    this.visible = true;\n    this.updateItems();\n    this.modalPanel.show();\n    this.focusFilterEditor();\n  }\n  hide() {\n    this.visible = false;\n    this.modalPanel.hide();\n  }\n  getFilterKey(): string {\n    return \"Label\";\n  }\n  viewForItem(item: Object): string {\n    return `<li>${item.Label}</li>`\n  }\n  cancelled() {\n    this.hide();\n    atom.views.getView(atom.workspace.getActiveTextEditor()).focus();\n  }\n  confirmed(item: Object) {\n    var editor = atom.workspace.getActiveTextEditor();\n    var oldText: string = editor.getText();\n    var oldHeader: string = Header(editor.getText())[0];\n    var newHeader: string;\n    if (item.Remove) {\n      newHeader = RemoveImport(oldHeader, item.Path);\n    } else {\n      newHeader = AddImport(oldHeader, item.Path, pathAliases()[item.Path] || \"\");\n    }\n    var oldLines = oldHeader.split(\"\\n\").length;\n    editor.setTextInBufferRange([[0,0], [oldLines-1, 0]], newHeader);\n    var editorEl = atom.views.getView(editor);\n    this.hide();\n    editorEl.focus();\n  }\n}\n"]}